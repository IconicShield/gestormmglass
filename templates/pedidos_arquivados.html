{% extends 'base.html' %}

{% block content %}
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1>Arquivados</h1>
        <div>
            <a href="{{ url_for('exportar_arquivados') }}" class="btn btn-success"><i class="fas fa-file-excel"></i> Exportar .xlsx</a>
            <a href="{{ url_for('painel_controle') }}" class="btn btn-secondary"><i class="fas fa-arrow-left"></i> Voltar ao Painel Principal</a>
        </div>
    </div>

    <!-- Formulário de Filtros -->
    <div class="card shadow-sm mb-4">
        <div class="card-header">
            <h6 class="mb-0">Filtros de Busca</h6>
        </div>
        <div class="card-body">
            <form method="GET" class="mb-0">
                <div class="row">
                    <div class="col-lg-2 col-md-4 col-sm-6">
                        <div class="form-group">
                            <label for="search_numero">Buscar por Número:</label>
                            <input type="text" class="form-control" id="search_numero" name="search_numero" 
                                   value="{{ search_numero }}" placeholder="Digite o número do pedido">
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-4 col-sm-6">
                        <div class="form-group">
                            <label for="search_cliente">Buscar por Cliente:</label>
                            <input type="text" class="form-control" id="search_cliente" name="search_cliente" 
                                   value="{{ search_cliente }}" placeholder="Digite o nome do cliente">
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-4 col-sm-6">
                        <div class="form-group">
                            <label for="search_descricao">Buscar por Descrição:</label>
                            <input type="text" class="form-control" id="search_descricao" name="search_descricao" 
                                   value="{{ search_descricao }}" placeholder="Digite a descrição do trabalho">
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-6 col-sm-6">
                        <div class="form-group">
                            <label for="filter_status">Status:</label>
                            <select class="form-control" id="filter_status" name="filter_status">
                                <option value="">Todos</option>
                                <option value="Não iniciado" {{ 'selected' if filter_status == 'Não iniciado' }}>Não iniciado</option>
                                <option value="Em andamento" {{ 'selected' if filter_status == 'Em andamento' }}>Em andamento</option>
                                <option value="Concluído" {{ 'selected' if filter_status == 'Concluído' }}>Concluído</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-6 col-sm-6">
                        <div class="form-group">
                            <label for="filter_tipo">Tipo:</label>
                            <select class="form-control" id="filter_tipo" name="filter_tipo">
                                <option value="">Todos</option>
                                <option value="Pedido" {{ 'selected' if filter_tipo == 'Pedido' }}>Pedido</option>
                                <option value="Orçamento" {{ 'selected' if filter_tipo == 'Orçamento' }}>Orçamento</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-md-6">
                        <button type="submit" class="btn btn-primary mr-2">
                            <i class="fas fa-search"></i> Filtrar
                        </button>
                        <a href="{{ url_for('pedidos_arquivados') }}" class="btn btn-secondary">
                            <i class="fas fa-times"></i> Limpar Filtros
                        </a>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-6">
            <h3><i class="fas fa-box-open"></i> Pedidos Arquivados</h3>
            
            <!-- Botões de ação em lote para Pedidos Arquivados -->
            <div class="mb-3" id="pedidos-arquivados-bulk-actions" style="display: none;">
                <div class="d-flex align-items-center">
                    <span class="mr-3 text-muted"><span id="pedidos-arquivados-selected-count">0</span> item(ns) selecionado(s)</span>
                    <button type="button" class="btn btn-info btn-sm mr-2" onclick="bulkRestorePedidosArquivados()">
                        <i class="fas fa-undo"></i> Restaurar Selecionados
                    </button>
                    <button type="button" class="btn btn-danger btn-sm" onclick="bulkDeletePedidosArquivados()">
                        <i class="fas fa-trash-alt"></i> Excluir Selecionados
                    </button>
                </div>
            </div>
            
            <!-- Informações da paginação -->
            <div class="mb-3">
                <small class="text-muted">
                    Mostrando {{ ((pedidos.page - 1) * pedidos.per_page) + 1 }} a 
                    {{ pedidos.page * pedidos.per_page if pedidos.page * pedidos.per_page <= pedidos.total else pedidos.total }} 
                    de {{ pedidos.total }} pedido(s) arquivado(s)
                    {% if search_cliente or filter_status or filter_tipo %}
                        <span class="badge badge-info">Filtros aplicados</span>
                    {% endif %}
                </small>
            </div>
            <table class="table table-hover table-sm shadow-sm rounded table-uppercase">
                <thead class="thead-light">
                    <tr>
                        <th width="30">
                            <input type="checkbox" id="select-all-pedidos-arquivados" onchange="toggleAllPedidosArquivados(this)">
                        </th>
                        <th>N°</th>
                        <th>N° Cliente</th>
                        <th>Cliente</th>
                        <th>Status</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody>
                    {% for entrada in pedidos.items %}
                    <tr>
                        <td>
                            <input type="checkbox" class="pedido-arquivado-checkbox" value="{{ entrada.id }}" onchange="updatePedidosArquivadosBulkActions()">
                        </td>
                        <td>
                            <button type="button" class="btn btn-outline-secondary btn-sm" style="color: var(--text-color);" data-toggle="modal" data-target="#detalhesModal-{{ entrada.id }}">
                                {% if entrada.numero_pedido > 1000000000 and entrada.tipo == 'Orçamento' %}
                                    <i class="fas fa-search"></i> Detalhes
                                {% else %}
                                    {{ entrada.numero_pedido }}
                                {% endif %}
                            </button>
                        </td>
                                                <td>
                            {% if entrada.cliente %}
                                <button type="button" class="btn btn-outline-secondary btn-sm" style="color: var(--text-color);" data-toggle="modal" data-target="#clienteDetalhesModal-{{ entrada.cliente.id }}">
                                    {{ entrada.cliente.numero_cliente }}
                                </button>
                            {% else %}
                                -
                            {% endif %}
                        </td>
                        <td>
                            {% if entrada.cliente %}
                                {{ entrada.cliente.nome }}
                            {% else %}
                                {{ entrada.cliente_nome_temp }}
                            {% endif %}
                        </td>
                        <td>
                            {% set status_color = 'secondary' %}
                            {% if entrada.status == 'Concluído' %}{% set status_color = 'success' %}
                            {% elif entrada.status == 'Em andamento' %}{% set status_color = 'warning' %}
                            {% elif entrada.status == 'Não iniciado' %}{% set status_color = 'danger' %}{% endif %}
                            <span class="badge badge-{{ status_color }}">{{ entrada.status }}</span>
                        </td>
                        <td>
                            <form action="{{ url_for('desarquivar_entrada', id=entrada.id) }}" method="post" style="display: inline;">
                                <button type="submit" class="btn btn-sm btn-info" title="Restaurar Pedido">
                                    <i class="fas fa-undo"></i>
                                </button>
                            </form>
                             <form action="{{ url_for('excluir_entrada', id=entrada.id) }}" method="post" style="display: inline;" onsubmit="return confirm('ATENÇÃO: Exclusão permanente! Tem a certeza?');">
                                <button type="submit" class="btn btn-sm btn-danger" title="Excluir Permanentemente">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </form>
                        </td>
                    </tr>
                    {% else %}
                    <tr><td colspan="6" class="text-center">Nenhum pedido arquivado.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="col-lg-6">
            <h3><i class="fas fa-file-invoice-dollar"></i> Orçamentos Arquivados</h3>
            
            <!-- Botões de ação em lote para Orçamentos Arquivados -->
            <div class="mb-3" id="orcamentos-arquivados-bulk-actions" style="display: none;">
                <div class="d-flex align-items-center">
                    <span class="mr-3 text-muted"><span id="orcamentos-arquivados-selected-count">0</span> item(ns) selecionado(s)</span>
                    <button type="button" class="btn btn-info btn-sm mr-2" onclick="bulkRestoreOrcamentosArquivados()">
                        <i class="fas fa-undo"></i> Restaurar Selecionados
                    </button>
                    <button type="button" class="btn btn-danger btn-sm" onclick="bulkDeleteOrcamentosArquivados()">
                        <i class="fas fa-trash-alt"></i> Excluir Selecionados
                    </button>
                </div>
            </div>
            
            <!-- Informações da paginação para orçamentos -->
            <div class="mb-3">
                <small class="text-muted">
                    Mostrando {{ ((orcamentos.page - 1) * orcamentos.per_page) + 1 }} a 
                    {{ orcamentos.page * orcamentos.per_page if orcamentos.page * orcamentos.per_page <= orcamentos.total else orcamentos.total }} 
                    de {{ orcamentos.total }} orçamento(s) arquivado(s)
                    {% if search_cliente or filter_status or filter_tipo %}
                        <span class="badge badge-info">Filtros aplicados</span>
                    {% endif %}
                </small>
            </div>
            <table class="table table-hover table-sm shadow-sm rounded table-uppercase">
                <thead class="thead-light">
                    <tr>
                        <th width="30">
                            <input type="checkbox" id="select-all-orcamentos-arquivados" onchange="toggleAllOrcamentosArquivados(this)">
                        </th>
                        <th>N°</th>
                        <th>Cliente</th>
                        <th>Status</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody>
                    {% for entrada in orcamentos.items %}
                    <tr>
                        <td>
                            <input type="checkbox" class="orcamento-arquivado-checkbox" value="{{ entrada.id }}" onchange="updateOrcamentosArquivadosBulkActions()">
                        </td>
                        <td>
                            <button type="button" class="btn btn-outline-secondary btn-sm" style="color: var(--text-color);" data-toggle="modal" data-target="#detalhesModal-{{ entrada.id }}">
                                {% if entrada.numero_pedido > 1000000000 and entrada.tipo == 'Orçamento' %}
                                    <i class="fas fa-search"></i> Detalhes
                                {% else %}
                                    {{ entrada.numero_pedido }}
                                {% endif %}
                            </button>
                        </td>
                        <td>
                            {% if entrada.cliente %}
                                <button type="button" class="btn btn-outline-secondary btn-sm" style="color: var(--text-color);" data-toggle="modal" data-target="#clienteDetalhesModal-{{ entrada.cliente.id }}">
                                    {{ entrada.cliente.numero_cliente }}
                                </button>
                            {% else %}
                                -
                            {% endif %}
                        </td>
                        <td>
                            {% if entrada.cliente %}
                                {{ entrada.cliente.nome }}
                            {% else %}
                                {{ entrada.cliente_nome_temp }}
                            {% endif %}
                        </td>
                        <td>
                            {% set status_color = 'secondary' %}
                            {% if entrada.status == 'Concluído' %}{% set status_color = 'success' %}
                            {% elif entrada.status == 'Em andamento' %}{% set status_color = 'warning' %}
                            {% elif entrada.status == 'Não iniciado' %}{% set status_color = 'danger' %}{% endif %}
                            <span class="badge badge-{{ status_color }}">{{ entrada.status }}</span>
                        </td>
                        <td>
                            <form action="{{ url_for('desarquivar_entrada', id=entrada.id) }}" method="post" style="display: inline;">
                                <button type="submit" class="btn btn-sm btn-info" title="Restaurar Orçamento">
                                    <i class="fas fa-undo"></i>
                                </button>
                            </form>
                             <form action="{{ url_for('excluir_entrada', id=entrada.id) }}" method="post" style="display: inline;" onsubmit="return confirm('ATENÇÃO: Exclusão permanente! Tem a certeza?');">
                                <button type="submit" class="btn btn-sm btn-danger" title="Excluir Permanentemente">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </form>
                        </td>
                    </tr>
                    {% else %}
                    <tr><td colspan="5" class="text-center">Nenhum orçamento arquivado.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- Pagination Controls -->
    <div class="row mt-4">
        <!-- Paginação para Pedidos -->
        <div class="col-lg-6">
            {% if pedidos.pages > 1 %}
            <nav aria-label="Navegação de pedidos arquivados">
                <ul class="pagination justify-content-center">
                    {% if pedidos.has_prev %}
                        <li class="page-item">
                            <a class="page-link" href="{{ url_for('pedidos_arquivados', pedidos_page=pedidos.prev_num, orcamentos_page=orcamentos.page, search_cliente=search_cliente, filter_status=filter_status, filter_tipo=filter_tipo) }}" aria-label="Anterior">
                                <span aria-hidden="true">&laquo;</span>
                            </a>
                        </li>
                    {% else %}
                        <li class="page-item disabled">
                            <span class="page-link">&laquo;</span>
                        </li>
                    {% endif %}
                    
                    {% for page_num in pedidos.iter_pages() %}
                        {% if page_num %}
                            {% if page_num != pedidos.page %}
                                <li class="page-item">
                                    <a class="page-link" href="{{ url_for('pedidos_arquivados', pedidos_page=page_num, orcamentos_page=orcamentos.page, search_cliente=search_cliente, filter_status=filter_status, filter_tipo=filter_tipo) }}">{{ page_num }}</a>
                                </li>
                            {% else %}
                                <li class="page-item active">
                                    <span class="page-link">{{ page_num }}</span>
                                </li>
                            {% endif %}
                        {% else %}
                            <li class="page-item disabled">
                                <span class="page-link">…</span>
                            </li>
                        {% endif %}
                    {% endfor %}
                    
                    {% if pedidos.has_next %}
                        <li class="page-item">
                            <a class="page-link" href="{{ url_for('pedidos_arquivados', pedidos_page=pedidos.next_num, orcamentos_page=orcamentos.page, search_cliente=search_cliente, filter_status=filter_status, filter_tipo=filter_tipo) }}" aria-label="Próximo">
                                <span aria-hidden="true">&raquo;</span>
                            </a>
                        </li>
                    {% else %}
                        <li class="page-item disabled">
                            <span class="page-link">&raquo;</span>
                        </li>
                    {% endif %}
                </ul>
            </nav>
            {% endif %}
        </div>
        
        <!-- Paginação para Orçamentos -->
        <div class="col-lg-6">
            {% if orcamentos.pages > 1 %}
            <nav aria-label="Navegação de páginas - Orçamentos">
                <ul class="pagination justify-content-center pagination-sm">
                    {% if orcamentos.has_prev %}
                        <li class="page-item">
                            <a class="page-link" href="{{ url_for('pedidos_arquivados', pedidos_page=pedidos.page, orcamentos_page=orcamentos.prev_num, search_cliente=search_cliente, filter_status=filter_status, filter_tipo=filter_tipo) }}" aria-label="Anterior">
                                <span aria-hidden="true">&laquo;</span>
                            </a>
                        </li>
                    {% else %}
                        <li class="page-item disabled">
                            <span class="page-link">&laquo;</span>
                        </li>
                    {% endif %}
                    
                    {% for page_num in orcamentos.iter_pages() %}
                        {% if page_num %}
                            {% if page_num != orcamentos.page %}
                                <li class="page-item">
                                    <a class="page-link" href="{{ url_for('pedidos_arquivados', pedidos_page=pedidos.page, orcamentos_page=page_num, search_cliente=search_cliente, filter_status=filter_status, filter_tipo=filter_tipo) }}">{{ page_num }}</a>
                                </li>
                            {% else %}
                                <li class="page-item active">
                                    <span class="page-link">{{ page_num }}</span>
                                </li>
                            {% endif %}
                        {% else %}
                            <li class="page-item disabled">
                                <span class="page-link">…</span>
                            </li>
                        {% endif %}
                    {% endfor %}
                    
                    {% if orcamentos.has_next %}
                        <li class="page-item">
                            <a class="page-link" href="{{ url_for('pedidos_arquivados', pedidos_page=pedidos.page, orcamentos_page=orcamentos.next_num, search_cliente=search_cliente, filter_status=filter_status, filter_tipo=filter_tipo) }}" aria-label="Próximo">
                                <span aria-hidden="true">&raquo;</span>
                            </a>
                        </li>
                    {% else %}
                        <li class="page-item disabled">
                            <span class="page-link">&raquo;</span>
                        </li>
                    {% endif %}
                </ul>
            </nav>
            {% endif %}
        </div>
    </div>
<style>
    :root {
        --bg-primary: #2d3748;
        --bg-secondary: #2d3748;
        --border-color: #4a5568;
        --text-primary: #e2e8f0;
        --text-secondary: #a0aec0;
        --hover-bg: #1a365d;
        --hover-border: #4299e1;
        --input-bg: #2d3748;
        --input-border: #4a5568;
        --input-text: #e2e8f0;
    }
    
    [data-theme="light"] {
        --bg-primary: #ffffff;
        --bg-secondary: #f8f9fa;
        --border-color: #dee2e6;
        --text-primary: #212529;
        --text-secondary: #6c757d;
        --hover-bg: #e3f2fd;
        --hover-border: #007bff;
        --input-bg: #ffffff;
        --input-border: #ced4da;
        --input-text: #495057;
    }
    
    /* Estilos para campos de formulário */
    .form-control {
        background-color: var(--input-bg) !important;
        border-color: var(--input-border) !important;
        color: var(--input-text) !important;
    }
    
    .form-control:focus {
        background-color: var(--input-bg) !important;
        border-color: var(--hover-border) !important;
        color: var(--input-text) !important;
        box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25) !important;
    }
    
    .form-control::placeholder {
        color: var(--text-secondary) !important;
    }
    
    /* Labels */
    label {
        color: var(--text-primary) !important;
    }
    
    /* Cards */
    .card {
        background-color: var(--bg-primary) !important;
        border-color: var(--border-color) !important;
    }
    
    .card-header {
        background-color: var(--bg-secondary) !important;
        border-color: var(--border-color) !important;
        color: var(--text-primary) !important;
    }
    
    .card-body {
        background-color: var(--bg-primary) !important;
        color: var(--text-primary) !important;
    }
    
    /* Tabelas */
    .table {
        color: var(--text-primary) !important;
    }
    
    .table th {
        background-color: var(--bg-secondary) !important;
        border-color: var(--border-color) !important;
        color: var(--text-primary) !important;
    }
    
    .table td {
        background-color: var(--bg-primary) !important;
        border-color: var(--border-color) !important;
        color: var(--text-primary) !important;
    }
    
    .table-striped tbody tr:nth-of-type(odd) {
        background-color: var(--bg-secondary) !important;
    }
</style>

{% endblock %}

{% block modals %}
    {# --- MODAL DE DETALHES DO CLIENTE --- #}
    {% set clientes_unicos = [] %}
    {% for entrada in pedidos.items + orcamentos.items %}
        {% if entrada.cliente and entrada.cliente not in clientes_unicos %}
            {% do clientes_unicos.append(entrada.cliente) %}
        {% endif %}
    {% endfor %}

    {% for cliente in clientes_unicos %}
    <div class="modal fade" id="clienteDetalhesModal-{{ cliente.id }}" tabindex="-1" role="dialog" aria-labelledby="clienteModalLabel-{{ cliente.id }}" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="clienteModalLabel-{{ cliente.id }}">Detalhes de: {{ cliente.nome }}</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6>Dados Pessoais</h6><hr class="mt-1 mb-2">
                            <dl class="row mb-0">
                                <dt class="col-sm-4">N° Cliente:</dt><dd class="col-sm-8">{{ cliente.numero_cliente }}</dd>
                                <dt class="col-sm-4">Nome:</dt><dd class="col-sm-8 text-uppercase">{{ cliente.nome }}</dd>
                                <dt class="col-sm-4">Telefone:</dt><dd class="col-sm-8">{{ cliente.telefone or '-' }}</dd>
                                <dt class="col-sm-4">Tipo Pessoa:</dt><dd class="col-sm-8">{{ cliente.tipo_pessoa }}</dd>
                                <dt class="col-sm-4">CPF/CNPJ:</dt><dd class="col-sm-8">{{ cliente.cpf_cnpj or '-' }}</dd>
                                <dt class="col-sm-4">Como Conheceu:</dt><dd class="col-sm-8">{{ cliente.como_conheceu or '-' }}</dd>
                            </dl>
                        </div>
                        <div class="col-md-6">
                            <h6>Endereço</h6><hr class="mt-1 mb-2">
                            <dl class="row mb-0">
                                <dt class="col-sm-4">Rua:</dt><dd class="col-sm-8 text-uppercase">{{ cliente.rua or '-' }}</dd>
                                <dt class="col-sm-4">Número:</dt><dd class="col-sm-8">{{ cliente.numero_endereco or '-' }}</dd>
                                <dt class="col-sm-4">Complemento:</dt><dd class="col-sm-8 text-uppercase">{{ cliente.complemento or '-' }}</dd>
                                <dt class="col-sm-4">Bairro:</dt><dd class="col-sm-8 text-uppercase">{{ cliente.bairro or '-' }}</dd>
                                <dt class="col-sm-4">Cidade:</dt><dd class="col-sm-8 text-uppercase">{{ cliente.cidade or '-' }}</dd>
                                <dt class="col-sm-4">UF:</dt><dd class="col-sm-8 text-uppercase">{{ cliente.uf or '-' }}</dd>
                                <dt class="col-sm-4">CEP:</dt><dd class="col-sm-8">{{ cliente.cep or '-' }}</dd>
                            </dl>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-12">
                            <h6>Observações</h6><hr class="mt-1 mb-2">
                            <p style="white-space: pre-wrap;">{{ cliente.observacoes or 'Nenhuma observação.' }}</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
                    <a href="{{ url_for('editar_cliente', id=cliente.id) }}" class="btn btn-primary">Editar Cliente</a>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}

    {# --- MODAIS DE DETALHES DA ENTRADA --- #}
    {% for entrada in pedidos.items + orcamentos.items %}
    <div class="modal fade" id="detalhesModal-{{ entrada.id }}" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Detalhes do {{ entrada.tipo }} #{{ entrada.numero_pedido }}</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6><i class="fas fa-info-circle text-primary"></i> Informações Gerais</h6><hr class="mt-1">
                            <dl class="row">
                                <dt class="col-sm-5">N° da Entrada</dt><dd class="col-sm-7">{{ entrada.numero_pedido }}</dd>
                                <dt class="col-sm-5">Tipo</dt><dd class="col-sm-7">{{ entrada.tipo }}</dd>
                                <dt class="col-sm-5">Data de Registo</dt><dd class="col-sm-7">{{ entrada.data_registro.strftime('%d/%m/%Y às %H:%M') }}</dd>
                                <dt class="col-sm-5">Cliente</dt><dd class="col-sm-7 text-uppercase">{% if entrada.cliente %}{{ entrada.cliente.nome }}{% else %}{{ entrada.cliente_nome_temp }}{% endif %}</dd>
                                <dt class="col-sm-5">Status</dt><dd class="col-sm-7">{% set status_color = 'secondary' %}{% if entrada.status == 'Concluído' %}{% set status_color = 'success' %}{% elif entrada.status == 'Em andamento' %}{% set status_color = 'warning' %}{% elif entrada.status == 'Não iniciado' %}{% set status_color = 'danger' %}{% endif %}<span class="badge badge-{{ status_color }}">{{ entrada.status }}</span></dd>
                            </dl>
                        </div>
                        <div class="col-md-6">
                            <h6><i class="fas fa-paperclip text-primary"></i> Anexos</h6><hr class="mt-1">
                            <p class="text-muted small">Total de {{ entrada.anexos|length }} anexo(s).</p>
                            <a href="{{ url_for('editar_entrada', id=entrada.id) }}" class="btn btn-outline-secondary btn-sm"><i class="fas fa-plus"></i> Gerir Anexos</a>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-12">
                            <h6><i class="fas fa-align-left text-primary"></i> Descrição</h6><hr class="mt-1">
                            <p class="text-uppercase" style="white-space: pre-wrap;">{{ entrada.descricao }}</p>
                            <h6 class="mt-3"><i class="fas fa-comment-alt text-primary"></i> Observações</h6><hr class="mt-1">
                            <p class="text-uppercase" style="white-space: pre-wrap;">{{ entrada.observacoes or 'Nenhuma observação.' }}</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <a href="{{ url_for('editar_entrada', id=entrada.id) }}" class="btn btn-info"><i class="fas fa-edit"></i> Editar</a>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
{% endblock %}

{% block scripts %}
<script>
// Funções para seleção em massa de Pedidos Arquivados
function toggleAllPedidosArquivados(selectAllCheckbox) {
    const checkboxes = document.querySelectorAll('.pedido-arquivado-checkbox');
    checkboxes.forEach(checkbox => {
        checkbox.checked = selectAllCheckbox.checked;
    });
    updatePedidosArquivadosBulkActions();
}

function updatePedidosArquivadosBulkActions() {
    const checkboxes = document.querySelectorAll('.pedido-arquivado-checkbox:checked');
    const bulkActions = document.getElementById('pedidos-arquivados-bulk-actions');
    const selectedCount = document.getElementById('pedidos-arquivados-selected-count');
    
    if (checkboxes.length > 0) {
        bulkActions.style.display = 'block';
        selectedCount.textContent = checkboxes.length;
    } else {
        bulkActions.style.display = 'none';
    }
    
    // Atualizar estado do "selecionar todos"
    const allCheckboxes = document.querySelectorAll('.pedido-arquivado-checkbox');
    const selectAllCheckbox = document.getElementById('select-all-pedidos-arquivados');
    selectAllCheckbox.checked = allCheckboxes.length > 0 && checkboxes.length === allCheckboxes.length;
}

function bulkRestorePedidosArquivados() {
    const checkboxes = document.querySelectorAll('.pedido-arquivado-checkbox:checked');
    const ids = Array.from(checkboxes).map(cb => cb.value);
    
    if (ids.length === 0) {
        alert('Selecione pelo menos um item para restaurar.');
        return;
    }
    
    if (confirm(`Deseja restaurar ${ids.length} pedido(s) selecionado(s)?`)) {
        bulkActionPedidosArquivados('restore', ids);
    }
}

function bulkDeletePedidosArquivados() {
    const checkboxes = document.querySelectorAll('.pedido-arquivado-checkbox:checked');
    const ids = Array.from(checkboxes).map(cb => cb.value);
    
    if (ids.length === 0) {
        alert('Selecione pelo menos um item para excluir.');
        return;
    }
    
    if (confirm(`Deseja excluir permanentemente ${ids.length} pedido(s) selecionado(s)? Esta ação não pode ser desfeita.`)) {
        bulkActionPedidosArquivados('delete', ids);
    }
}

// Funções para seleção em massa de Orçamentos Arquivados
function toggleAllOrcamentosArquivados(selectAllCheckbox) {
    const checkboxes = document.querySelectorAll('.orcamento-arquivado-checkbox');
    checkboxes.forEach(checkbox => {
        checkbox.checked = selectAllCheckbox.checked;
    });
    updateOrcamentosArquivadosBulkActions();
}

function updateOrcamentosArquivadosBulkActions() {
    const checkboxes = document.querySelectorAll('.orcamento-arquivado-checkbox:checked');
    const bulkActions = document.getElementById('orcamentos-arquivados-bulk-actions');
    const selectedCount = document.getElementById('orcamentos-arquivados-selected-count');
    
    if (checkboxes.length > 0) {
        bulkActions.style.display = 'block';
        selectedCount.textContent = checkboxes.length;
    } else {
        bulkActions.style.display = 'none';
    }
    
    // Atualizar estado do "selecionar todos"
    const allCheckboxes = document.querySelectorAll('.orcamento-arquivado-checkbox');
    const selectAllCheckbox = document.getElementById('select-all-orcamentos-arquivados');
    selectAllCheckbox.checked = allCheckboxes.length > 0 && checkboxes.length === allCheckboxes.length;
}

function bulkRestoreOrcamentosArquivados() {
    const checkboxes = document.querySelectorAll('.orcamento-arquivado-checkbox:checked');
    const ids = Array.from(checkboxes).map(cb => cb.value);
    
    if (ids.length === 0) {
        alert('Selecione pelo menos um item para restaurar.');
        return;
    }
    
    if (confirm(`Deseja restaurar ${ids.length} orçamento(s) selecionado(s)?`)) {
        bulkActionOrcamentosArquivados('restore', ids);
    }
}

function bulkDeleteOrcamentosArquivados() {
    const checkboxes = document.querySelectorAll('.orcamento-arquivado-checkbox:checked');
    const ids = Array.from(checkboxes).map(cb => cb.value);
    
    if (ids.length === 0) {
        alert('Selecione pelo menos um item para excluir.');
        return;
    }
    
    if (confirm(`Deseja excluir permanentemente ${ids.length} orçamento(s) selecionado(s)? Esta ação não pode ser desfeita.`)) {
        bulkActionOrcamentosArquivados('delete', ids);
    }
}

// Função para executar ações em lote para pedidos arquivados
function bulkActionPedidosArquivados(action, ids) {
    const xhr = new XMLHttpRequest();
    xhr.open('POST', '/bulk-action-archived', true);
    xhr.setRequestHeader('Content-Type', 'application/json');
    
    xhr.onreadystatechange = function() {
        if (xhr.readyState === 4) {
            if (xhr.status === 200) {
                const response = JSON.parse(xhr.responseText);
                if (response.success) {
                    location.reload();
                } else {
                    alert('Erro: ' + response.message);
                }
            } else {
                alert('Erro ao processar a solicitação.');
            }
        }
    };
    
    xhr.send(JSON.stringify({
        action: action,
        ids: ids
    }));
}

// Função para executar ações em lote para orçamentos arquivados
function bulkActionOrcamentosArquivados(action, ids) {
    const xhr = new XMLHttpRequest();
    xhr.open('POST', '/bulk-action-archived', true);
    xhr.setRequestHeader('Content-Type', 'application/json');
    
    xhr.onreadystatechange = function() {
        if (xhr.readyState === 4) {
            if (xhr.status === 200) {
                const response = JSON.parse(xhr.responseText);
                if (response.success) {
                    location.reload();
                } else {
                    alert('Erro: ' + response.message);
                }
            } else {
                alert('Erro ao processar a solicitação.');
            }
        }
    };
    
    xhr.send(JSON.stringify({
        action: action,
        ids: ids
    }));
}
</script>
{% endblock %}